<!DOCTYPE html>
<html>
<head>
  <title>Meme generator</title>
  <style type="text/css">
    /* Base CSS */
    * {
      box-sizing: border-box;
    }

    html, body {
      font-family: Helvetica, sans-serif;
    }

    label {
      cursor: pointer;
    }

    /* Flexbox grid component */
    .flex-grid {
      display: flex;
    }

    .flex-col-1,
    .flex-col-2 {
      padding-right: 20px;
    }

    .flex-col-1 {
      flex-grow: 1;
    }

    .flex-col-2 {
      flex-grow: 2;
    }

    .flex-col-3 {
      flex-grow: 3;
    }

    /* https://github.com/csswizardry/inuit.css/blob/v5.0.1/objects/_flexbox.scss */
    .table {
      display: table;
      width: 100%;
    }

    html.table {
      display: block;
      width: auto;
    }

    .table__item {
        display: table-cell;
        /*vertical-align: middle;*/
    }

    /* CSS widths */
    /* DEV: Similar classes would be `one-half`, `two-thirds` */
    .one-half {
      width: 50%;
    }
    .one-third {
      width: 33.3333%;
    }
    .one-quarter {
      width: 25%;
    }

    .one-whole {
      width: 100%;
    }

    /* Button modifications */
    .btn-large {
      padding: 0.5em;
      font-size: 1.5em;
    }

    .btn-block {
      width: 100%;
      cursor: pointer;
    }

    /* TODO: Document me */
    .hidden-radio {
      position: relative;
    }

    .hidden-radio input[type="radio"] {
      display: none;
    }

    .hidden-radio--checked {
      background: #007DD6; /* Light blue */
    }

    /**
      Page specific CSS
     */
    .meme-img {
      width: 250px;
    }

    .meme-select-item {
      padding: 20px;
      display: inline-block;
      width: 290px; /* 250px meme + 20px * 2 padding */
    }

    /**
      Trumps
     */
    .hidden {
      display: none;
    }

    .invisible {
      visibility: hidden;
    }

    .block {
      display: block;
    }

  </style>
  <script>
    (function initClosure () {
      // Define our constants
      var HIDDEN_RADIO_SELECTOR = '.hidden-radio';
      var HIDDEN_RADIO_CHECKED_CLASS = 'hidden-radio--checked';

      // When our DOM is ready, set up our bindings
      // TODO: Build me as a JS plugin
      function init() {
        // Find our all hidden radio classes
        var $hiddenRadioContainers = document.querySelectorAll(HIDDEN_RADIO_SELECTOR);

        // For each of our containers, bind to their input's change events
        var $lastContainer;
        [].slice.call($hiddenRadioContainers).forEach(function bindEvents ($container) {
          // Find its respective input
          var $input = $container.querySelector('input[type=radio]');

          // Bind to its change events
          function handleChange(evt) {
            // If the input is checked
            if ($input.checked) {
              // Add a `checked` state to our container
              $container.classList.add(HIDDEN_RADIO_CHECKED_CLASS);

              // If there was a last container, then remove its class
              // DEV: No `change` event fires upon deselection
              if ($lastContainer) {
                $lastContainer.classList.remove(HIDDEN_RADIO_CHECKED_CLASS);
              }

              // Save our container as the last container
              $lastContainer = $container;
            }
          }
          $input.addEventListener('change', handleChange);

          // Trigger the event now
          handleChange(null);
        });
      }
      // http://youmightnotneedjquery.com/#ready
      document.addEventListener('DOMContentLoaded', init);
    }());
  </script>
</head>
<body>
  <h1>Meme generator</h1>
  <div class="table">
    <div class="table__item one-half">
      <!-- TODO: Either make this scrollable or the "Enter meme content fixed" -->
      <h2>Select a meme</h2>
      <div>
      {% for img in imgs %}
        <!-- TODO: Make these target setting a value in the select -->
        <label class="hidden-radio meme-select-item">
          <strong>{{ img.name }}</strong>
          <br/>
          <input type="radio" name="meme" value="{{ img.name }}" {% if img.selected %} checked="checked" {% endif %}/>
          <img src="{{ img.url }}" class="meme-img" />
        </label>
      {% endfor %}
      </div>
    </div>
    <div class="table__item one-quarter">
      <h2>Enter meme content</h2>
      <form id="meme-form">
        <div>
          <!-- TODO: Bind selecting a meme here to toggling a radio -->
          <label>Meme:</label>
          <select name="meme" class="one-whole">
            {% for img in imgs %}
              <option name="meme" value="{{ img.key }}">{{ img.name }}</option>
            {% endfor %}
          </select>
        </div>
        <div style="padding: 5px 0;">
          <label>Top:</label>
          <input type="text" name="top" placeholder="your text" class="one-whole"/>
        </div>
        <div style="padding: 5px 0;">
          <label>Bottom:</label>
          <input type="text" name="bottom" placeholder="goes here" class="one-whole"/>
        </div>
        <p>
          <button type="submit" class="btn-large btn-block">Generate meme</button>
        </p>
      </form>
    </div>
    <div class="table__item one-quarter" id="result">
      <h2>Result</h2>
      <img id="result-img" class="meme-img hidden"/>
      <!-- TODO: Consider moving to p over br -->
      <br/>
      <a id="result-href" class="hidden"></a>
      <!-- Define a width placeholder for our img -->
      <div class="meme-img invisible">&nbsp;</div>
    </div>
  </div>
  <script>
    (function formInitClosure () {
      // Define a helper for our custom escape logic
      // https://github.com/jacebrowning/memegen/tree/5672d03cec2db0a525a02bfedf604afc654a3cb6#special-characters
      function escapeMemeText(str) {
        return str
          .replace(/-/g, '--')
          .replace(/_/g, '__')
          .replace(/\?/g, '~q')
          .replace(/%/g, '~p');
      }

      // When our page loads, add our bindings
      function init() {
        // Find our form, its elements, and our result container
        var $memeForm = document.getElementById('meme-form');
        var $memeSelect = $memeForm.querySelector('select[name=meme]');
        var $memeTop = $memeForm.querySelector('input[name=top]');
        var $memeBottom = $memeForm.querySelector('input[name=bottom]');
        var $result = document.getElementById('result');
        var $resultImg = document.getElementById('result-img');
        var $resultHref = document.getElementById('result-href');

        // When our form is submitted, fill our our result
        $memeForm.addEventListener('submit', function populateResult (evt) {
          // Prevent default form actions and from it reaching other targets
          evt.preventDefault();
          evt.stopPropagation();

          // Collect info from our form
          var meme = $memeSelect.value;
          var memeTop = $memeTop.value;
          var memeBottom = $memeBottom.value;
          // http://memegen.link/afraid/hello/world.jpg
          var location = window.location;
          var memeUrl = location.protocol + '//' + location.host + '/' + encodeURIComponent(meme) +
            '/' + encodeURIComponent(memeTop) + '/' + encodeURIComponent(memeBottom) + '.jpg';
          var memeTextParts = [];
          if (memeTop) {
            memeTextParts.push(memeTop);
          }
          if (memeBottom) {
            memeTextParts.push(memeBottom);
          }
          var memeText = memeTextParts.join(' ');

          // Make our result elements visible
          $resultImg.classList.remove('hidden');
          $resultHref.classList.remove('hidden');

          // Update our result img and link
          $resultImg.src = memeUrl;
          $resultImg.alt = memeText;
          $resultHref.href= memeUrl;
          $resultHref.textContent = memeUrl;
        });
      }
      // http://youmightnotneedjquery.com/#ready
      document.addEventListener('DOMContentLoaded', init);
    }());
  </script>
</body>
</html>
